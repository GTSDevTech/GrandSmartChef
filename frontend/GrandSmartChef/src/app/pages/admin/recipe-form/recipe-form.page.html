<ion-content (ionScroll)="onScroll($event)" [fullscreen]="true">
  <!-- IMAGEN -->
  <div class="image-container" style="position: relative;">
    <ion-img [src]="previewUrl || recipe()?.imageUrl || 'assets/images/default_recipe_image.png'" class="recipe-image-preview" alt="Imagen de la receta"></ion-img>

    <!-- Botón volver atrás -->
    <ion-fab vertical="top" horizontal="start" slot="fixed" class="fab-top-left">
      <ion-button fill="clear" class="circle-button" (click)="onClose()">
        <ion-icon size="large" name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-fab>

    <!-- Botón cámara -->
    <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="fab-bottom-right">
      <ion-fab-button (click)="pickImage()" class="camera-button">
        <ion-icon name="camera"></ion-icon>
      </ion-fab-button>
    </ion-fab>

    <input type="file" #fileInput hidden accept="image/*" (change)="onFileSelected($event)">
  </div>

  <ion-grid>
    <!-- NOMBRE -->
    <ion-row class="row-item">
      <h3>Título</h3>
      <ion-item lines="full" class="recipe-name-item">
        <ion-input [(ngModel)]="form.name" placeholder="Nombre de la receta"></ion-input>
      </ion-item>
    </ion-row>

    <!-- DATOS PRINCIPALES -->
    <ion-row class="ion-padding-horizontal center-container-column main-data-row">
      <ion-col size="3" class="detail-item">
        <ion-icon name="timer-outline" size="large"></ion-icon>
        <ion-input [(ngModel)]="form.prepTime" placeholder="minutos"></ion-input>
      </ion-col>

      <ion-col size="3" class="detail-item">
        <ion-icon name="people-outline" size="large"></ion-icon>
        <ion-input [(ngModel)]="form.servings" placeholder="personas"></ion-input>
      </ion-col>

      <ion-col size="3" class="detail-item">
        <ion-icon name="speedometer-outline" size="large"></ion-icon>
        <ion-input [(ngModel)]="form.difficulty" placeholder="dificultad"></ion-input>
      </ion-col>
    </ion-row>

    <!-- TAGS -->
    <ion-row class="row-item">
      <h3>Tags</h3>
      <ion-item class="recipe-name-item">
        <ion-input [(ngModel)]="tagInput" placeholder="Añadir tag..."></ion-input>
        <ion-button fill="clear" class="add-btn" (click)="addTag()">
          <ion-icon name="add"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-row class="tags-row">
        <ion-col size="auto" *ngFor="let tg of form.tags; index as i">
          <ion-button size="small" shape="round" class="button-tags">
            {{ tg }}
            <ion-icon name="close" (click)="removeTag(i)" style="margin-left:4px"></ion-icon>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-row>

    <!-- DESCRIPCIÓN -->
    <ion-row class="row-item">
      <h3>Descripción</h3>
      <ion-item class="recipe-name-item" lines="none">
        <ion-textarea auto-grow="true" [(ngModel)]="form.description" placeholder="Describe la receta…"></ion-textarea>
      </ion-item>
    </ion-row>

    <!-- INGREDIENTES -->
    <ion-row class="row-item">
      <h3>Ingredientes</h3>
      <ion-item>
        <ion-select [(ngModel)]="selectedIngredientId" placeholder="Seleccionar ingrediente">
          <ion-select-option *ngFor="let ingredient of ingredientsCatalog" [value]="ingredient.id">
            {{ ingredient.name }}
          </ion-select-option>
        </ion-select>

        <ion-input [(ngModel)]="ingredientQty" placeholder="Cantidad"></ion-input>
        <ion-input [(ngModel)]="ingredientUnit" placeholder="Unidad"></ion-input>
        <ion-button fill="clear" class="add-btn" (click)="addIngredient()">
          <ion-icon name="add"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-list class="ingredient-list">
        <ion-item class="ingredient-item" *ngFor="let ing of form.ingredients; index as i">
          <ion-col size="3">
            <ion-label class="quantity">
              {{ ing.quantity }} <span>{{ ing.unit }}</span>
            </ion-label>
          </ion-col>
          <ion-col>
            <ion-label class="name">{{ ing.ingredientName }}</ion-label>
          </ion-col>
          <ion-button fill="clear" color="danger" (click)="removeIngredient(i)">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
    </ion-row>

    <!-- PASOS -->
    <ion-row class="row-item">
      <h3>Preparación</h3>
      <ion-item class="recipe-name-item">
        <ion-input [(ngModel)]="stepInput" placeholder="Nuevo paso…"></ion-input>
        <ion-button fill="solid" class="add-btn" (click)="addStep()">
          <ion-icon name="add"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-list class="recipe-name-item">
        <ion-item lines="none" *ngFor="let step of form.steps; index as i" class="step-item">
          <ion-button class="steps">{{ i + 1 }}</ion-button>
          <ion-label class="name ion-padding-horizontal">{{ step }}</ion-label>
          <ion-button fill="clear" color="danger" (click)="removeStep(i)">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
    </ion-row>

    <!-- BOTÓN GUARDAR -->
    <ion-row class="ion-padding ion-justify-content-center">
      <ion-button expand="block" class="save-btn" [disabled]="!formValid" (click)="saveLocal()">GUARDAR</ion-button>
    </ion-row>

  </ion-grid>
</ion-content>
